
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://argoproj.github.io/argo-rollouts/features/canary/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.8">
    
    
      
        <title>Canary - Argo Rollouts - Kubernetes Progressive Delivery Controller</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.92558b1b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:300,400,400i,700%7C&display=fallback">
        <style>:root{--md-text-font-family:"Work Sans";--md-code-font-family:""}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#canary-deployment-strategy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Argo Rollouts - Kubernetes Progressive Delivery Controller" class="md-header__button md-logo" aria-label="Argo Rollouts - Kubernetes Progressive Delivery Controller" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Argo Rollouts - Kubernetes Progressive Delivery Controller
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Canary
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/argoproj/argo-rollouts/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Argo Rollouts - Kubernetes Progressive Delivery Controller" class="md-nav__button md-logo" aria-label="Argo Rollouts - Kubernetes Progressive Delivery Controller" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Argo Rollouts - Kubernetes Progressive Delivery Controller
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/argoproj/argo-rollouts/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        Getting Started
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        Basic Usage
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/ambassador/" class="md-nav__link">
        Ambassador
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/alb/" class="md-nav__link">
        AWS ALB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/istio/" class="md-nav__link">
        Istio
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/nginx/" class="md-nav__link">
        NGINX
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/smi/" class="md-nav__link">
        SMI
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../dashboard/" class="md-nav__link">
        Dashboard
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" checked>
      
      <label class="md-nav__link" for="__nav_7">
        Rollout
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Rollout" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Rollout
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" type="checkbox" id="__nav_7_1" checked>
      
      <label class="md-nav__link" for="__nav_7_1">
        Deployment Strategies
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Deployment Strategies" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Deployment Strategies
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../bluegreen/" class="md-nav__link">
        BlueGreen
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Canary
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Canary
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pause-duration" class="md-nav__link">
    Pause Duration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-canary-scale-with-traffic-routing" class="md-nav__link">
    Dynamic Canary Scale (with Traffic Routing)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-stable-scale-with-traffic-routing" class="md-nav__link">
    Dynamic Stable Scale (with Traffic Routing)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mimicking-rolling-update" class="md-nav__link">
    Mimicking Rolling Update
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-configurable-features" class="md-nav__link">
    Other Configurable Features
  </a>
  
    <nav class="md-nav" aria-label="Other Configurable Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#antiaffinity" class="md-nav__link">
    antiAffinity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canaryservice" class="md-nav__link">
    canaryService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stableservice" class="md-nav__link">
    stableService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maxsurge" class="md-nav__link">
    maxSurge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maxunavailable" class="md-nav__link">
    maxUnavailable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trafficrouting" class="md-nav__link">
    trafficRouting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../specification/" class="md-nav__link">
        Rollout Spec
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../hpa-support/" class="md-nav__link">
        HPA
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ephemeral-metadata/" class="md-nav__link">
        Ephemeral Metadata
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../restart/" class="md-nav__link">
        Restarting Rollouts
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../scaledown-aborted-rs/" class="md-nav__link">
        Scaledown Aborted Rollouts
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../anti-affinity/anti-affinity/" class="md-nav__link">
        Anti Affinity
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../helm/" class="md-nav__link">
        Helm
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../kustomize/" class="md-nav__link">
        Kustomize
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../controller-metrics/" class="md-nav__link">
        Controller Metrics
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        Traffic Management
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Traffic Management" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Traffic Management
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../traffic-management/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../traffic-management/ambassador/" class="md-nav__link">
        Ambassador
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../traffic-management/alb/" class="md-nav__link">
        AWS ALB
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../traffic-management/istio/" class="md-nav__link">
        Istio
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../traffic-management/nginx/" class="md-nav__link">
        NGINX
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../traffic-management/smi/" class="md-nav__link">
        SMI
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      <label class="md-nav__link" for="__nav_9">
        Analysis
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Analysis" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Analysis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../analysis/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../analysis/prometheus/" class="md-nav__link">
        Prometheus
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../analysis/datadog/" class="md-nav__link">
        DataDog
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../analysis/newrelic/" class="md-nav__link">
        NewRelic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../analysis/wavefront/" class="md-nav__link">
        Wavefront
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../analysis/job/" class="md-nav__link">
        Job
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../analysis/web/" class="md-nav__link">
        Web
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../analysis/kayenta/" class="md-nav__link">
        Kayenta
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../analysis/cloudwatch/" class="md-nav__link">
        CloudWatch
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../experiment/" class="md-nav__link">
        Experiments
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      <label class="md-nav__link" for="__nav_11">
        Notifications
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Notifications" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          Notifications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../notifications/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11_2" type="checkbox" id="__nav_11_2" >
      
      <label class="md-nav__link" for="__nav_11_2">
        Services
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Services" data-md-level="2">
        <label class="md-nav__title" for="__nav_11_2">
          <span class="md-nav__icon md-icon"></span>
          Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/notification-services/email/" class="md-nav__link">
        Email
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/notification-services/github/" class="md-nav__link">
        GitHub
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/notification-services/grafana/" class="md-nav__link">
        Grafana
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/notification-services/mattermost/" class="md-nav__link">
        Mattermost
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/notification-services/opsgenie/" class="md-nav__link">
        Opsgenie
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/notification-services/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/notification-services/rocketchat/" class="md-nav__link">
        Rocket.Chat
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/notification-services/slack/" class="md-nav__link">
        Slack
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/notification-services/teams/" class="md-nav__link">
        Teams
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/notification-services/telegram/" class="md-nav__link">
        Telegram
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/notification-services/webhook/" class="md-nav__link">
        Webhook
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12" type="checkbox" id="__nav_12" >
      
      <label class="md-nav__link" for="__nav_12">
        Kubectl Plugin
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Kubectl Plugin" data-md-level="1">
        <label class="md-nav__title" for="__nav_12">
          <span class="md-nav__icon md-icon"></span>
          Kubectl Plugin
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../kubectl-plugin/" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_12_2" type="checkbox" id="__nav_12_2" >
      
      <label class="md-nav__link" for="__nav_12_2">
        Commands
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Commands" data-md-level="2">
        <label class="md-nav__title" for="__nav_12_2">
          <span class="md-nav__icon md-icon"></span>
          Commands
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts/" class="md-nav__link">
        Rollouts
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_abort/" class="md-nav__link">
        Rollouts Abort
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_completion/" class="md-nav__link">
        Rollouts Completion
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_create/" class="md-nav__link">
        Rollouts Create
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_create_analysisrun/" class="md-nav__link">
        Rollouts Create Analysisrun
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_dashboard/" class="md-nav__link">
        Rollouts Dashboard
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_get/" class="md-nav__link">
        Rollouts Get
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_get_experiment/" class="md-nav__link">
        Rollouts Get Experiment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_get_rollout/" class="md-nav__link">
        Rollouts Get Rollout
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_lint/" class="md-nav__link">
        Rollouts Lint
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_list/" class="md-nav__link">
        Rollouts List
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_list_experiments/" class="md-nav__link">
        Rollouts List Experiments
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_list_rollouts/" class="md-nav__link">
        Rollouts List Rollouts
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_notifications/" class="md-nav__link">
        Rollouts Notifications
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_notifications_template/" class="md-nav__link">
        Rollouts Notifications Template
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_notifications_template_get/" class="md-nav__link">
        Rollouts Notifications Template Get
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_notifications_template_notify/" class="md-nav__link">
        Rollouts Notifications Template Notify
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_notifications_trigger/" class="md-nav__link">
        Rollouts Notifications Trigger
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_notifications_trigger_get/" class="md-nav__link">
        Rollouts Notifications Trigger Get
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_notifications_trigger_run/" class="md-nav__link">
        Rollouts Notifications Trigger Run
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_pause/" class="md-nav__link">
        Rollouts Pause
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_promote/" class="md-nav__link">
        Rollouts Promote
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_restart/" class="md-nav__link">
        Rollouts Restart
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_retry/" class="md-nav__link">
        Rollouts Retry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_retry_experiment/" class="md-nav__link">
        Rollouts Retry Experiment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_retry_rollout/" class="md-nav__link">
        Rollouts Retry Rollout
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_set/" class="md-nav__link">
        Rollouts Set
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_set_image/" class="md-nav__link">
        Rollouts Set Image
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_status/" class="md-nav__link">
        Rollouts Status
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_terminate/" class="md-nav__link">
        Rollouts Terminate
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_terminate_analysisrun/" class="md-nav__link">
        Rollouts Terminate Analysisrun
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_terminate_experiment/" class="md-nav__link">
        Rollouts Terminate Experiment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_undo/" class="md-nav__link">
        Rollouts Undo
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generated/kubectl-argo-rollouts/kubectl-argo-rollouts_version/" class="md-nav__link">
        Rollouts Version
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/" class="md-nav__link">
        Best Practices
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../migrating/" class="md-nav__link">
        Migrating
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../FAQ/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../security/" class="md-nav__link">
        Security
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../roadmap/" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_18" type="checkbox" id="__nav_18" >
      
      <label class="md-nav__link" for="__nav_18">
        Contributing
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Contributing" data-md-level="1">
        <label class="md-nav__title" for="__nav_18">
          <span class="md-nav__icon md-icon"></span>
          Contributing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        Contribution Guide
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/setup/" class="md-nav__link">
        Environment Setup
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../releasing/" class="md-nav__link">
        Releasing
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/argoproj/argo-rollouts/releases" class="md-nav__link">
        Releases ⧉
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/argoproj/argo-rollouts/milestones" class="md-nav__link">
        Roadmap ⧉
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://blog.argoproj.io/" class="md-nav__link">
        Blog ⧉
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pause-duration" class="md-nav__link">
    Pause Duration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-canary-scale-with-traffic-routing" class="md-nav__link">
    Dynamic Canary Scale (with Traffic Routing)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamic-stable-scale-with-traffic-routing" class="md-nav__link">
    Dynamic Stable Scale (with Traffic Routing)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mimicking-rolling-update" class="md-nav__link">
    Mimicking Rolling Update
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-configurable-features" class="md-nav__link">
    Other Configurable Features
  </a>
  
    <nav class="md-nav" aria-label="Other Configurable Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#antiaffinity" class="md-nav__link">
    antiAffinity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#canaryservice" class="md-nav__link">
    canaryService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stableservice" class="md-nav__link">
    stableService
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maxsurge" class="md-nav__link">
    maxSurge
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maxunavailable" class="md-nav__link">
    maxUnavailable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trafficrouting" class="md-nav__link">
    trafficRouting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/argoproj/argo-rollouts/edit/master/docs/features/canary.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="canary-deployment-strategy">Canary Deployment Strategy<a class="headerlink" href="#canary-deployment-strategy" title="Permanent link">&para;</a></h1>
<p>A canary rollout is a deployment strategy where the operator releases a new version of their application to a small percentage of the production traffic. </p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Since there is no agreed upon standard for a canary deployment, the rollouts controller allows users to outline how they want to run their canary deployment. Users can define a list of steps the controller uses to manipulate the ReplicaSets when there is a change to the <code>.spec.template</code>. Each step will be evaluated before the new ReplicaSet is promoted to the stable version, and the old version is completely scaled down.</p>
<p>Each step can have one of two fields. The <code>setWeight</code> field dictates the percentage of traffic that should be sent to the canary, and the <code>pause</code> struct instructs the rollout to pause.  When the controller reaches a <code>pause</code> step for a rollout, it will set adds a PauseCondition struct to the <code>.status.PauseConditions</code> field. If the <code>duration</code> field within the <code>pause</code> struct is set, the rollout will not progress to the next step until it has waited for the value of the <code>duration</code> field. Otherwise, the rollout will wait indefinitely until that Pause condition is removed. By using the <code>setWeight</code> and the <code>pause</code> fields, a user can declarative describe how they want to progress to the new version. Below is an example of a canary strategy.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If the canary Rollout does not use <a href="../traffic-management/">traffic management</a>, the Rollout makes a best effort attempt to achieve the percentage listed in the last <code>setWeight</code> step between the new and old version. For example, if a Rollout has 10 Replicas and 10% for the first <code>setWeight</code> step, the controller will scale the new desired ReplicaSet to 1 replicas and the old stable ReplicaSet to 9. In the case where the setWeight is 15%, the Rollout attempts to get there by rounding up the calculation (i.e. the new ReplicaSet has 2 pods since 15% of 10, rounds up to 2 and the old ReplicaSet has 9 pods since 85% of 10, rounds up to 9). If a user wants to have more fine-grained control of the percentages without a large number of Replicas, that user should use the  <a href="#trafficrouting">traffic management</a> functionality.</p>
</div>
<h2 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">argoproj.io/v1alpha1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Rollout</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example-rollout</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">matchLabels</span><span class="p">:</span>
      <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx</span>
        <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nginx:1.15.4</span>
        <span class="nt">ports</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">containerPort</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
  <span class="nt">minReadySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
  <span class="nt">revisionHistoryLimit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">canary</span><span class="p">:</span> <span class="c1">#Indicates that the rollout should use the Canary strategy</span>
      <span class="nt">maxSurge</span><span class="p">:</span> <span class="s">&quot;25%&quot;</span>
      <span class="nt">maxUnavailable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
      <span class="nt">steps</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">setWeight</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
      <span class="p p-Indicator">-</span> <span class="nt">pause</span><span class="p">:</span>
          <span class="nt">duration</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1h</span> <span class="c1"># 1 hour</span>
      <span class="p p-Indicator">-</span> <span class="nt">setWeight</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">20</span>
      <span class="p p-Indicator">-</span> <span class="nt">pause</span><span class="p">:</span> <span class="p p-Indicator">{}</span> <span class="c1"># pause indefinitely</span>
</code></pre></div>
<h2 id="pause-duration">Pause Duration<a class="headerlink" href="#pause-duration" title="Permanent link">&para;</a></h2>
<p>Pause duration can be specified with an optional time unit suffix. Valid time units are "s", "m", "h". Defaults to "s" if not specified.</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">canary</span><span class="p">:</span>
      <span class="nt">steps</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">pause</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> duration</span><span class="p">:</span> <span class="nv">10</span> <span class="p p-Indicator">}</span>  <span class="c1"># 10 seconds</span>
        <span class="p p-Indicator">-</span> <span class="nt">pause</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> duration</span><span class="p">:</span> <span class="nv">10s</span> <span class="p p-Indicator">}</span> <span class="c1"># 10 seconds</span>
        <span class="p p-Indicator">-</span> <span class="nt">pause</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> duration</span><span class="p">:</span> <span class="nv">10m</span> <span class="p p-Indicator">}</span> <span class="c1"># 10 minutes</span>
        <span class="p p-Indicator">-</span> <span class="nt">pause</span><span class="p">:</span> <span class="p p-Indicator">{</span><span class="nt"> duration</span><span class="p">:</span> <span class="nv">10h</span> <span class="p p-Indicator">}</span> <span class="c1"># 10 hours</span>
        <span class="p p-Indicator">-</span> <span class="nt">pause</span><span class="p">:</span> <span class="p p-Indicator">{}</span>                <span class="c1"># pause indefinitely</span>
</code></pre></div>
<p>If no <code>duration</code> is specified for a pause step, the rollout will be paused indefinitely. To unpause, use the <a href="../kubectl-plugin/">argo kubectl plugin</a> <code>promote</code> command. </p>
<div class="highlight"><pre><span></span><code><span class="c1"># promote to the next step</span>
kubectl argo rollouts promote &lt;rollout&gt;
</code></pre></div>
<h2 id="dynamic-canary-scale-with-traffic-routing">Dynamic Canary Scale (with Traffic Routing)<a class="headerlink" href="#dynamic-canary-scale-with-traffic-routing" title="Permanent link">&para;</a></h2>
<p>By default, the rollout controller will scale the canary to match the current trafficWeight of the
current step. For example, if the current weight is 25%, and there are four replicas, then the
canary will be scaled to 1, to match the traffic weight.</p>
<p>It is possible to control the canary replica's scale during the steps such that it does not necessary
match the traffic weight. Some use cases for this:</p>
<ol>
<li>The new version should not yet be exposed to the public (setWeight: 0), but you would like to
   scale the canary up for testing purposes.</li>
<li>You wish to scale the canary stack up minimally, and use some header based traffic shaping to
   the canary, while setWeight is still set to 0.</li>
<li>You wish to scale the canary up to 100%, in order to facilitate traffic shadowing.</li>
</ol>
<div class="admonition important">
<p class="admonition-title">Important</p>
</div>
<p>Setting canary scale is only available when using the canary strategy with a traffic router, since
  the basic canary needs to control canary scale in order to approximate canary weight.</p>
<p>To control canary weights during steps, use the <code>setCanaryScale</code> step and indicate which scale the
the canary should use:</p>
<ul>
<li>explicit replica count</li>
<li>explicit weight percentage of total spec.replicas</li>
<li>to match current canary setWeight</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">canary</span><span class="p">:</span>
      <span class="nt">steps</span><span class="p">:</span>
      <span class="c1"># explicit count</span>
      <span class="p p-Indicator">-</span> <span class="nt">setCanaryScale</span><span class="p">:</span>
          <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="c1"># a percentage of spec.replicas</span>
      <span class="p p-Indicator">-</span> <span class="nt">setCanaryScale</span><span class="p">:</span>
          <span class="nt">weight</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">25</span>
      <span class="c1"># matchTrafficWeight returns to the default behavior of matching the canary traffic weight</span>
      <span class="p p-Indicator">-</span> <span class="nt">setCanaryScale</span><span class="p">:</span>
          <span class="nt">matchTrafficWeight</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>When using <code>setCanaryScale</code> with explicit values for either replicas or weight, one must be careful
if used in conjunction with the <code>setWeight</code> step. If done incorrectly, an imbalanced amount of traffic
may be directed to the canary (in proportion to the Rollout's scale). For example, the following set
of steps would cause 90% of traffic to only be served by 10% of pods:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">canary</span><span class="p">:</span>
      <span class="nt">steps</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">setCanaryScale</span><span class="p">:</span>
          <span class="nt">weight</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
      <span class="p p-Indicator">-</span> <span class="nt">setWeight</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">90</span>
      <span class="p p-Indicator">-</span> <span class="nt">pause</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
</code></pre></div>
<h2 id="dynamic-stable-scale-with-traffic-routing">Dynamic Stable Scale (with Traffic Routing)<a class="headerlink" href="#dynamic-stable-scale-with-traffic-routing" title="Permanent link">&para;</a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Available since v1.1</p>
</div>
<p>When using traffic routing, by default the stable ReplicaSet is left scaled to 100% during the update.
This has the advantage that if an abort occurs, traffic can be immediately shifted back to the
stable ReplicaSet without delay. However, it has the disadvantage that during the update, there will
eventually exist double the number of replica pods running (similar to in a blue-green deployment),
since the stable ReplicaSet is left scaled up for the full duration of the update.</p>
<p>It is possible to dynamically reduce the scale of the stable ReplicaSet during an update such that
it scales down as the traffic weight increases to canary. This would be desirable in scenarios where
the Rollout has a high replica count and resource cost is a concern, or in bare-metal situations
where it is not possible to create additional node capacity to accommodate double the replicas.</p>
<p>The ability to dynamically scale the stable ReplicaSet can be enabled by setting the
<code>canary.dynamicStableScale</code> flag to true:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">canary</span><span class="p">:</span>
      <span class="nt">dynamicStableScale</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div>
<p>NOTE: that if <code>dynamicStableScale</code> is set, and the rollout is aborted, the canary ReplicaSet will
dynamically scale down as traffic shifts back to stable. If you wish to leave the canary ReplicaSet
scaled up while aborting, an explicit value for <code>abortScaleDownDelaySeconds</code> can be set:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">canary</span><span class="p">:</span>
      <span class="nt">dynamicStableScale</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">abortScaleDownDelaySeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">600</span>
</code></pre></div>
<h2 id="mimicking-rolling-update">Mimicking Rolling Update<a class="headerlink" href="#mimicking-rolling-update" title="Permanent link">&para;</a></h2>
<p>If the <code>steps</code> field is omitted, the canary strategy will mimic the rolling update behavior. Similar to the deployment, the canary strategy has the <code>maxSurge</code> and <code>maxUnavailable</code> fields to configure how the Rollout should progress to the new version.</p>
<h2 id="other-configurable-features">Other Configurable Features<a class="headerlink" href="#other-configurable-features" title="Permanent link">&para;</a></h2>
<p>Here are the optional fields that will modify the behavior of canary strategy:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">canary</span><span class="p">:</span>
      <span class="nt">analysis</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
      <span class="nt">antiAffinity</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
      <span class="nt">canaryService</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
      <span class="nt">stableService</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
      <span class="nt">maxSurge</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stringOrInt</span>
      <span class="nt">maxUnavailable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stringOrInt</span>
      <span class="nt">trafficRouting</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">object</span>
</code></pre></div>
<h3 id="analysis">analysis<a class="headerlink" href="#analysis" title="Permanent link">&para;</a></h3>
<p>Configure the background <a href="../analysis/">Analysis</a> to execute during the rollout. If the analysis is unsuccessful the rollout will be aborted.</p>
<p>Defaults to nil</p>
<h3 id="antiaffinity">antiAffinity<a class="headerlink" href="#antiaffinity" title="Permanent link">&para;</a></h3>
<p>Check out the <a href="../anti-affinity/anti-affinity/">Anti Affinity document</a> document for more information.</p>
<p>Defaults to nil</p>
<h3 id="canaryservice">canaryService<a class="headerlink" href="#canaryservice" title="Permanent link">&para;</a></h3>
<p><code>canaryService</code> references a Service that will be modified to send traffic to only the canary ReplicaSet. This allows users to only hit the canary ReplicaSet.</p>
<p>Defaults to an empty string</p>
<h3 id="stableservice">stableService<a class="headerlink" href="#stableservice" title="Permanent link">&para;</a></h3>
<p><code>stableService</code> the name of a Service which selects pods with stable version and doesn't select any pods with canary version. This allows users to only hit the stable ReplicaSet.</p>
<p>Defaults to an empty string</p>
<h3 id="maxsurge">maxSurge<a class="headerlink" href="#maxsurge" title="Permanent link">&para;</a></h3>
<p><code>maxSurge</code> defines the maximum number of replicas the rollout can create to move to the correct ratio set by the last setWeight. Max Surge can either be an integer or percentage as a string (i.e. "20%")</p>
<p>Defaults to "25%".</p>
<h3 id="maxunavailable">maxUnavailable<a class="headerlink" href="#maxunavailable" title="Permanent link">&para;</a></h3>
<p>The maximum number of pods that can be unavailable during the update. Value can be an absolute number (ex: 5) or a percentage of desired pods (ex: 10%). This can not be 0 if MaxSurge is 0.</p>
<p>Defaults to 25%</p>
<h3 id="trafficrouting">trafficRouting<a class="headerlink" href="#trafficrouting" title="Permanent link">&para;</a></h3>
<p>The <a href="../traffic-management/">traffic management</a> rules to apply to control the flow of traffic between the active and canary versions. If not set, the default weighted pod replica based routing will be used.</p>
<p>Defaults to nil</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../bluegreen/" class="md-footer__link md-footer__link--prev" aria-label="Previous: BlueGreen" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              BlueGreen
            </div>
          </div>
        </a>
      
      
        
        <a href="../specification/" class="md-footer__link md-footer__link--next" aria-label="Next: Rollout Spec" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Rollout Spec
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.94ec81fe.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.48dfec6c.min.js"></script>
      
    
  </body>
</html>